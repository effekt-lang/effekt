import examples/benchmarks/runner

import io
import io/channel


def run(n: Int) = {
  val (sender, receiver) = channel::allocate()

  spawn(box {
    each(0, n) { i =>
      sender.send(Some(i))
    }
    sender.send(None())
  })

  var s = 0
  while (receiver.receive() is Some(v)) {
    s = s + v
  }
  return s
}

def main() = benchmark(5){run}

