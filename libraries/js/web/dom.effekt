module web/dom

extern type Node

// can be null
extern def getElementById(id: String) at pure: Node =
  js "document.getElementById(${id})"

extern def createElement(tag: String) at pure: Node =
  js "document.createElement(${tag})"

extern def createTextNode(text: String) at pure: Node =
  js "document.createTextNode(${text})"

extern def setAttribute(node: Node, key: String, value: String) at pure: Node =
  js "${node}.setAttribute(${key}, ${value})"

// the string return type is wrong here...
extern def getAttribute(node: Node, key: String) at pure: String =
  js "${node}.getAttribute(${key})"

extern def appendChild(node: Node, child: Node) at pure: Node =
  js "${node}.appendChild(${child})"

extern def innerHTML(node: Node, contents: String) at pure: Node =
  js "(function() { ${node}.innerHTML = ${contents}; return ${node} })()"

extern type IdleDeadline

extern def requestIdleCallback(callback: (IdleDeadline) => Unit at {io}) at pure: Unit =
  js "window.requestIdleCallback(deadline => ${callback}(deadline).run())"

extern def didDimeout(deadline: IdleDeadline) at pure: Bool =
  js "${deadline}.didTimeout"

extern def timeRemaining(deadline: IdleDeadline) at pure: Double =
  js "${deadline}.timeRemaining()"

extern def onClick(node: Node, handler: () => Unit at {io}) at pure: Node =
  js "(function() { ${node}.onclick = () => ${handler}().run(); return ${node} })()"

extern def sleep(n: Int): Unit =
  js "$effekt.callcc(k => window.setTimeout(() => k(null), ${n}))"

def clear(node: Node) = node.innerHTML("")
